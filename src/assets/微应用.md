涉及项目
1. 主应用
    a.  https://git.dustess.com/markting/biz/qw-manage-client 
2. 配置管理
    a.  https://git.dustess.com/markting/module/node/duerojs-config 
3. 微应用模版项目
    a.  https://git.dustess.com/markting/team/pc-micro-boilerplate 
4. 新的微应用项目
    a. 待创建
拆分流程
1. 阅读文档
    a. qiankun  https://qiankun.umijs.org/zh/guide/getting-started 
2. 在 GitLab 新增前端微应用项目
    a. 没有新增项目权限找各自前端Leader
3. 使用微应用模版项目 https://git.dustess.com/markting/team/pc-micro-boilerplate 进行微应用项目初始化
4. 确认拆分部分，进行代码拷贝
5. 配置管理
    a.  https://git.dustess.com/markting/module/node/duerojs-config 
    b. 没权限找各自前端Leader
6. 进行拆分
7. 拆分完毕，配置网关，在测试环境可访问
8. 测试进行验收
9. 上线

微应用拆分几个需要注意的事项
1、 组件关系
    a. 需要移动到全局的全局组件
    b. 需要移动到自己目录的业务组件
    c. 需要移动到全局的业务组件
2、 api
    a. 需要检查api命名是否一致，不一致以模板里面的规范为主
    b. 命名不一样的，通过duero-api.config.js配置文件查找
3、 utils
    a. 在组件中可以通过实例访问 this.$utils.Xxx
    b. 在组件外的通过import引入
4、 store
    a. 全局vuex-主应用把数据通过qiankun传到了子应用里面了，使用方法改为子应用的，不在使用vuex的方式，this.$qiankunActions.store.state.模块名.xxx
    b. 
    c. 
主应用拆分到微应用变更的地方
1. API的文件夹名称和导出的名称会换成规范的，记得迁移代码后进行更换
2. api不再使用全局 window 挂载，而是在当前使用页面 import 对应的 api，类似这样
import { MKQWACCOUNTSVC } from '@api'

3. 公用组件、util、插件等引入路径有变，新增common层，并且方法名称也变了
4. components下common里面的组件为全局组件，可直接使用无需引入，页面引入了全局组件删除引入直接使用
5. util自动挂载到this.$uitls下，无需引入，页面引入了utils的方法，直接使用this.$utils.xxx
6. 路由定义遵循就近原则放到当前模块根目录，不用在全局router里面定义
7. 记得检查静态资源、API、组件 等引入【模版里可能没有，需自己生成和引入】
8. 在微应用内调用【客户详情弹窗】的处理如下（微应用内不在使用客户详情弹窗组件）
this.$qiankunActions.setGlobalState({ msg: 'markting/master/showCustomerDetail', data: { id: customerId } })

9. 组件库引入改为了按需引入，所以缺失的组件可以到 src/plugins/common 下面的 mk-ui 和 element 去引入
10. 
拆分步骤
1. 确定主应用是否是：
    a. qw-manage-client
2. 新增微前端项目（微应用）：这里使用微应用模版来初始化新的微应用项目
3. 主应用需要拆分的模块代码拷贝到微应用（直播模块）

4. 修改微应用页面路径
    a. 微应用的入口地址

/deal-conversion：代表当前微应用项目：成交转换（自己定义的）
live-broadcast：代表当前的直播地址

    b. 入口路径对应页面路径
5. 路由不能使用懒加载
6. 查看迁移过来的页面使用的api和公用组件是否在当前页面引入（检查组件的路径）；像这种错误，就要按实际情况处理了
7. 运行微应用
    a. 记得yarn安装依赖
    b. 成功启动微应用（默认进入 enter-page）
    c. 注意这里的地址是可以自己配置，由于我这次迁移的是【成交转换】，因此我命名为【deal-conversion】

vue.config.js里面配置


    d. 然后关于<head-back>的back-path，要重新处理
        i. 在微应用项目，如果是微应用的入口页面，这块之前的为要改为写死的路由
        ii. 非入口页面的，那就不要back-path值去掉
    e. 在微应用内调用【客户详情弹窗】的处理如下
this.$qiankunActions.setGlobalState({ msg: 'markting/master/showCustomerDetail', data: { id: customerId } })

8. 修改package.json
9. 修改 public\json\version.json
10. 主应用引入微应用
    a. 在 https://git.dustess.com/markting/module/node/duerojs-config 项目加微应用的配置项【必须】如下图配置的dev
    b. 图片中的deal-conversion要与【第7.c步】的publicPath一致，否则无法正常引用微应用；记得每个环境都要配置
    c. 在主应用找到拆分模块的路径，设置重定向地址【重要】，并且注释掉它的component
    d. 在主应用main.js图片对应处配置微应用信息（本地联调使用）

拆分完成
1. 运行主应用
    a. F12查看network微应用是否成功启动
    b. 成功启动和正常展示

2. 最后要删除主应用内的相关模块，减小主应用的体积

子应用 CI/CD 配置
1. 修改 .gitlab-ci-s.yml 文件
// 将下面的
PROJECT_NAME: pc-micro-boilerplate
// 改为
PROJECT_NAME: qw-manage-deal-conversion-client

并且重命名为：.gitlab-ci.yml
2. 修改 Dockerfile 文件
// 将下面的
WORKDIR /app/pc-micro-boilerplate
ADD ./dist /app/pc-micro-boilerplate
// 改为
WORKDIR /app/deal-conversion
ADD ./dist /app/deal-conversion

deal-conversion 是当前项目的容器，是根据项目名称 qw-manage-deal-conversion-client 取中间那段
3. 修改 Makefile 文件
// 将下面的
imageName=markting/pc-micro-boilerplate
// 改为
imageName=markting/qw-manage-deal-conversion-client

4. 完成 CI/CD 修改
子应用网关配置
在加网关前，请先跑下对应项目的CI/CD，构建成功后才去加网关
请联系 冯羿 配置相应子应用的网关
这样给他说：
麻烦在 dev 环境上加下网关，具体如下：
前端服务名：qw-manage-deal-conversion-client；访问地址：https://qw-scrm-dev.dustess.com/deal-conversion/

重点描述：环境、前端服务名（即前端项目名称）、访问地址

应用中心菜单割接
请联系 张小鑫 配置应用中心相应的工具（新增修改都找他）
比如活码修改了地址：

麻烦在 test 环境上，改一下 应用中心-活码 的homePage地址:
homePage: "/live-code"

重点描述：环境、应用中心工具名称、访问地址
提测
首先要配置好网关（测试环境的网关 冯羿）
其次处理对应测试环境内的 duerojs-config 配置
应用中心菜单配置（张小鑫）
上线
首先要配置好网关（线上环境的网关 冯羿）
其次处理对应线上环境内的 duerojs-config 配置
应用中心菜单配置（张小鑫）
如果是新项目要注意：
1，新项目是一个新服务，需要后端配置，告诉后端这是一个新服务，后端不知道可以找彭亚川。
2，需要配置新的网关，这个也找后端（新的服务要注意配置mk开头和qw开头的两个），后端不知道就找冯羿，以 qw-manage-live-code-client 为例，发送给对应的人：

## 其一
访问地址：https://qw-scrm.dustess.com/live-code/
命名空间：
服务(项目名)：qw-manage-live-code-client
端口：80

## 其二
访问地址：https://mk.dustess.com/live-code/
访问地址：https://mk.7moor.com/live-code/
命名空间：
服务(项目名)：qw-manage-live-code-client
端口：80

3，duerojs-config项目注意配置相应环境的配置，然后将配置发给李海涛，后端发完版后通知他即可，举个例子：

{
    "name": "qw-manage-live-code-client",
    "entry": "https://qw-scrm.dustess.com/live-code/",
    "activeRule": "qw-manage/#/live-code",
    "container": "#microAppContainer"
}
今晚10点我们这边要升级这个微应用 ，需要你配置一下


4，新的子应用有相应的访问路径，无论是应用中心的某个应用还是某个菜单，都需要后端割接相应的菜单或路径，这需要找张小鑫来配置，举个例子

今晚要上线阿里云，应用中心-活码的地址要改成 /live-code


5，新的子应用需要更换或者增加上报配置，需要把应用地址给到 刘伟，他会处理上报。 


常见报错
1，如图，报跨域

如果配置无误，那可能就是服务挂了
登上吉利系统 https://ghillie-test.dustess.com/ 按如下操作进行重启


2，404 page not found

可能原因: 没部署到相应环境或者地址输入有误

